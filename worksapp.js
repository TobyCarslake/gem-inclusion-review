const data = [
  {
    "no": 1,
    "key": "L53YZDVV",
    "pop": "Agbenyega 2015, Thailand",
    "link": "https://eric.ed.gov/?id=EJ1069532",
    "intervention": "Inclusive",
    "outcomes": "Early,Attitude,Pedagogical",
    "country": "Thailand",
    "abstract": "Educating children with disabilities alongside their peers in mainstream preschools has increased intensely over the past few years, affecting all aspects of early childhood education. Many children who previously would have been educated in segregated special centres are now being included in inclusive preschools. This research paper discusses how Thai preschool teachers' professional knowledge in inclusive education influence the ways they practice within preschool classrooms. Qualitative data obtained through observations and collaborative inquiry with teachers drawn from four preschool in Bangkok, Thailand showed that the lack of adequate teacher preparation for inclusive practice rendered the teachers helpless and unable to deliver curriculum that caters for the learning needs of children with disabilities. This paper contributes to the growing body of research to inform the usefulness of collaborative inquiry in helping teachers explore educational issues in systematic ways and determine solutions through reflection and dialogic inquiry."
  },
  {
    "no": 2,
    "key": "ASE6LY3N",
    "pop": "Cheng 2015, China",
    "link": "http://dx.doi.org/10.1177/1525740114544027",
    "intervention": "Intellectual,Sensory",
    "outcomes": "Primary,Secondary,Attitude",
    "country": "China",
    "abstract": "The purpose of this article is to share a multicultural experience that took place in Guangzhou, China. The authors of this article joined a group of speech-language pathologists and audiologists to provide a training program for teachers and special education teachers in Guangzhou. It is our hope that this life changing experience will spark interest in our fellow professionals to act and to get involved internationally."
  },
  {
    "no": 3,
    "key": "WAXG3EQU",
    "pop": "Eng 2015, Vietnam",
    "link": "https://eric.ed.gov/?id=EJ1094919",
    "intervention": "Physical,Intellectual,Sensory",
    "outcomes": "Special,Pedagogical,Managing,Learning,Behaviour",
    "country": "Vietnam",
    "abstract": "This paper discusses how the process for IEP documentation was used in a training program for a group of young inexperienced teachers and teaching aides to effectively address the educational needs of children with diverse disabilities. Teachers at Kianh Centre in Vietnam received explicit instructions for writing effective functional individual education plans (IEPs). The authentic evidence-based IEP pro forma presently discussed, and was made culturally appropriate after many reviews and about a year of training. IEPs written on this pro forma were used as operational reference and working documents by both classroom and physical therapy staff for six and four months, respectively. Staff feedback on use of these documents was facilitated through a questionnaire. This paper presents the outcome of how IEP was used as a functional reference to empower staff to work with students with disabilities. Despite the diversity of disabilities of the students at Kianh Centre, all staff who participated agreed that IEPs written on the pro forma empowered them with effective skills to facilitate student learning."
  },
  {
    "no": 4,
    "key": "JQ6XUVUI",
    "pop": "Hai 2020, Vietnam",
    "link": "http://dx.doi.org/10.26822/iejee.2020358219",
    "intervention": "Inclusive",
    "outcomes": "Primary,Attitude,Pedagogical,Learning,Behaviour",
    "country": "Vietnam",
    "abstract": "School-based interventions involving teacher training programmes have been shown to benefit teachers' ability to identify and manage child mental health problems in developed countries. However, very few studies have been conducted in low-income countries with limited specialist services. The aim of the study was to evaluate the impact of the training programme on teachers' knowledge and awareness. A total of 114 primary school teachers from five schools in Karachi participated in a two-day (10-12 hours) workshop to provide them with an understanding of common child mental health problems and train them in basic skills. Their pre-and post-training knowledge was evaluated through a rating scale and open-ended questions. Single tailed \"t\"-test, involving paired differences, was applied for participants' scores. Pre-/post-training differences were statistically significant. The training sessions were associated with an improvement in teachers' knowledge and awareness of various signs and symptoms of common child mental health problems. The greatest improvement was noted in response to strategies of managing difficult behaviours, as 61% of respondents were able to formulate appropriate behavioural management techniques after the training. In low-income developing countries like Pakistan, teachers should be trained in early-intervention programmes for the identification and school-based management of less complex emotional and behavioural problems. Such interventions can maximise the use of sparse mental health resources."
  },
  {
    "no": 5,
    "key": "INW9G3QT",
    "pop": "Hussein 2013, Pakistan",
    "link": "http://dx.doi.org/10.1080/13632752.2013.819254",
    "intervention": "Intellectual",
    "outcomes": "Primary,Attitude,Managing",
    "country": "Pakistan",
    "abstract": "This study used a quasi-experimental research design to examine the impact of a professional learning program designed to enhance the competency of children with Autism, Attention Deficit Hyperactivity Disorder and Learning Disabilities and to develop knowledge, understanding and skills of teachers and parents in helping them. Data were collected from sample groups including administrators, teachers, students and parents. These sample groups were from 16 target schools, eight from Supanburi and eight from Khon Kaen provinces in Thailand. The instructional approaches were developed by teachers and taught in schools. Students were in Grades 1 to Grade 6. Research tools included parallel lesson plans, teaching materials and intervention techniques for enhancing student learning, a set of achievement tests and reflective forms. It was found that teachers and parents implemented intervention techniques which led to increased student academic performance and the development of a more collaborative approach to supporting children with diverse needs in Thailand."
  },
  {
    "no": 6,
    "key": "JRB3EZB4",
    "pop": "Kantavong 2010, Thailand",
    "link": "https://eric.ed.gov/?id=EJ872441",
    "intervention": "Intellectual",
    "outcomes": "Primary,Attitude,Pedagogical,Learning",
    "country": "Thailand",
    "abstract": "Despite extensive changes in early childhood inclusive education policy and practice, various barriers continue to inhibit access and participation of children with special needs in inclusive schools. Often mentioned barriers include negative beliefs, lack of understanding of inclusive pedagogy and the effectiveness of professional development to improve teacher knowledge to reduce these barriers. This study reports on a Thai Bureau of Special Education professional development partnership program with an Australian inclusive school in which 16 early childhood teachers from Thailand participated. This community of practice inquiry project generated qualitative data from pre- and post-professional workshops semi-structured interviews and analysis of teachers' professional learning journals during the inquiry phases of the project. Thematic analysis of the data showed that the international professional learning immersion program exerted an influential impact on the teachers who participated suggesting; teachers developed better understandings of children with special education needs by creating a mindset for change. � 2018, Social Science Press."
  },
  {
    "no": 7,
    "key": "P4RM7X2J",
    "pop": "Klibthong 2018, Thailand",
    "link": "http://dx.doi.org/10.14221/ajte.2018v43n3.7",
    "intervention": "Inclusive",
    "outcomes": "Early,Attitude",
    "country": "Thailand",
    "abstract": "Challenging behaviors are one of the basic problems that all pre- and in-service teachers have to be prepared to deal with in schools. In Thailand, it was found that challenging behaviors of students with disabilities had an effect on teachers' stress because many teachers perceived that they were lacking the knowledge and skills to deal with these problems. The primary purpose of this study was to evaluate the effectiveness of a modified version of a basic functional assessment (FBA) training package developed by Loman and Horner (2014) on increasing the knowledge and skills of Thai special education teachers with respect to the functional behavior assessment process. This process is a set of procedures developed in the United States for assisting practitioners in identifying appropriate function-based interventions in which the motivations of students are taking into account (Dunlap & Fox, 2011; Dunlap, Kern-Dunlap, Clarke, & Robbins, 1991; Foster-Johnson & Dunlap, 1993; Horner, 1994; Horner & Carr, 1997; Lane, Umbreit, & Beebe-Frankenberger, 1999). The original research questions from the Loman and Horner (2014) study were used. However, this study also examined whether a modified version of this training package would be effective within the cultural context of Thailand and whether it would be perceived as effective and acceptable by Thai special education teachers for implementation with Thai students in a Thai school. Twelve special education teachers who worked at a laboratory school in Thailand participated in this study. Nine of these special education teachers were randomly assigned to be in the intervention group, which received the training. The three remaining teachers were randomly assigned to the control group and did not receive the training. The results across a variety of measures indicated that all trained special education teachers increased their knowledge of the FBA process after receiving the training. Using a questionnaire that assessed the social validity of the training procedure, it was found that these teachers perceived the training as efficient, valuable, and acceptable for use by Thai teachers with Thai students in Thai schools. A number of recommendations are made based on this study with respect to how to improve the training process when used in Thailand or another country outside of the United States. Nevertheless, the most important finding of this study was that these procedures were effective in preparing these teachers to use the FBA process with their students. [The dissertation citations contained here are published with the permission of ProQuest LLC. Further reproduction is prohibited without permission. Copies of dissertations may be obtained by Telephone (800) 1-800-521-0600. Web page: http://www.proquest.com/en-US/products/dissertations/individuals.shtml.]"
  },
  {
    "no": 8,
    "key": "5CVH2LC4",
    "pop": "Locharoenrat 2019, Thailand",
    "link": "https://www.proquest.com/docview/2272840258",
    "intervention": "Inclusive",
    "outcomes": "Primary,Secondary,Managing",
    "country": "Thailand",
    "abstract": "Teacher cohorts in England and China received special training in techniques for teaching higher-level critical and creative cognitive strategies to deaf learners. Evaluation after 6 months of classroom implementation found students improved in reasoning and critical (but not creative) thinking and teachers developed cognitive terminology and self-perceptions as teachers of problem solving. (Contains references.) (Author/DB)"
  },
  {
    "no": 9,
    "key": "S5I7CJFS",
    "pop": "Martin 2001, China",
    "link": "https://www.jstor.org/stable/44390116",
    "intervention": "Sensory",
    "outcomes": "Special,Pedagogical,Learning,Behaviour",
    "country": "China",
    "abstract": "This article presents research that was conducted at the Autism Institute, an organization serving children with autism and their families in the People's Republic of China. The article examines and highlights aspects of the teacher training model at the Autism Institute that have led to the preparation of highly qualified, enthusiastic, and knowledgeable teachers of children with autism. Results of the research indicated that teacher education was highly valued at this organization, and teachers were seen as the most important part of the organization. Teachers received ongoing, systematic and specific on-the-job instruction. One of the most important features of this organization regarding teacher training was found to be the relationships between upper level staff including instructional leaders, and newer classroom teachers. These relationships were positive and based on mutual understanding and respect, and this has impacted the nature and success of teacher training. Implications for practice are discussed. [ABSTRACT FROM AUTHOR]"
  },
  {
    "no": 10,
    "key": "IN7M6QNL",
    "pop": "McCabe 2008, China",
    "link": "http://dx.doi.org/10.1177/088840640803100204",
    "intervention": "Intellectual",
    "outcomes": "Special,Attitude,Pedagogical",
    "country": "China",
    "abstract": "This article traces the evolution of special education policies and services in Vietnam from their introduction to the current expansion of inclusive education for children and youth with disabilities. Impacts reported include increased educational opportunity for and inclusion of children with disabilities, the development of national policy and provincial and local infrastructures for inclusive education, and capacity building for teachers through preservice, in-service, and master's and doctoral programs expressly designed to prepare personnel to forward inclusive education throughout the country. [ABSTRACT FROM AUTHOR]"
  },
  {
    "no": 11,
    "key": "U5HSKNUR",
    "pop": "Opartkiattikul 2015, Thailand",
    "link": "http://dx.doi.org/10.1177/1053451215577471",
    "intervention": "Inclusive",
    "outcomes": "Primary,Managing,Behaviour",
    "country": "Thailand",
    "abstract": "Thailand is aiming to improve special education practices, and inclusive education has been introduced and mandated by national laws in the past few years. However, inclusive practices are challenging for many Thai teachers and schools. Many teachers are unprepared to support students with diverse needs and to deal with behavior problems. To successfully support such students, teachers need to apply systematic and effective approaches. Functional behavioral assessment (FBA) is one such approach that may assist teachers in general classrooms. As FBA is a relatively new practice in Thailand, a contextualized approach is required. This article discusses several essential components in FBA implementation processes that need to be considered as well as an example of a research project that involved training Thai teachers in the use of FBA. � 2015, � Hammill Institute on Disabilities 2015."
  },
  {
    "no": 12,
    "key": "FYAZRAB8",
    "pop": "Salim 2019, Indonesia",
    "link": "https://eric.ed.gov/?id=EJ1239168",
    "intervention": "Inclusive",
    "outcomes": "Primary,Attitude",
    "country": "Indonesia",
    "abstract": "This study aimed to determine the effect of disability friendly education training on teachers' understanding by applying disability-friendly education training modules. The research design adopted the pre-posttest method given to the same group before and after training on imparting disability friendly education. Classroom teachers in inclusive schools under the Ministry of Religion in Surakarta were the subjects of this research. The validity of the instrument was tested by using content validity on the feasibility or relevance of the contents of the test instrument through rational analysis by expert judgment. The results showed that the paired sample T-Test score was - 17.736 with significant level at 0.000, which means <0.05. It suggests that there is a significant difference in the score of the average teacher's understanding of disability-friendly education before and after training, and the difference is statistically significant too. It can therefore be concluded that disability friendly educational training is effective to improve teachers' understanding in public schools."
  },
  {
    "no": 13,
    "key": "2KTKTLFJ",
    "pop": "Shah 2012, India",
    "link": "http://dx.doi.org/10.1007/s10597-011-9437-2",
    "intervention": "Intellectual",
    "outcomes": "Primary,Attitude,Pedagogical",
    "country": "India",
    "abstract": "The School Mental Health (SMH) services play critical roles fostering positive mental health and helping children with psychological problems. Despite its proven value, SMH services remain less developed in India. In this context, sensitizing teachers about child mental health issues could be considered as an important step in SMH promotion. Towards this goal, a large scale sensitization program for school teachers on SMH issues was carried out in an Indian city. This paper reports the process and the outcome of this sensitization program. � Springer Science+Business Media, LLC 2011."
  },
  {
    "no": 14,
    "key": "TQDWRQJ8",
    "pop": "Simpson 2016, China",
    "link": "https://www.iase.org/JIASE_2016.pdf#page=111",
    "intervention": "Intellectual",
    "outcomes": "Special,Pedagogical",
    "country": "China",
    "abstract": "Identifying students with ASD in the People's Republic of China (PRC) has lagged behind western countries, particularly the United States. Families often have to travel long distances to obtain a diagnosis and then are faced with few treatment options once the diagnosis is made. Recent laws governing special education in the PRC do not specifically address children with ASD; consequently, educational programs for these children are scarce. Though more special education teacher preparation programs are emerging, many are not well equipped to support teachers of children with ASD. Consequently, the need for in-service training in the area of ASD is significant. This manuscript discusses a collaborative two-year professional development project aimed at providing teachers in Nanjing, China, with much needed skills in working with students with ASD. A distance training model was employed to train teachers how to use informal assessment to guide instruction and monitor progress of their students. [ABSTRACT FROM AUTHOR]"
  },
  {
    "no": 15,
    "key": "7GSTUJPG",
    "pop": "Srivastava 2015, India",
    "link": "http://dx.doi.org/10.1080/21683603.2015.1064841",
    "intervention": "Inclusive",
    "outcomes": "Primary,Attitude,Pedagogical",
    "country": "India",
    "abstract": "Teachers are seen as key players in implementing inclusive education. However, extremely little attention has been paid to teacher preparation, particularly in India. The aim of the current study was to implement a teacher training program and evaluate its effects and appropriateness. This focused on increasing teachers' (a) attitudes, (b) knowledge about four types of special educational needs (i.e., attention deficit and hyperactivity disorder [ADHD], dyslexia, intellectual disability, and autistic spectrum disorder [ASD]), and (c) teaching methods. In a pre-posttest study, the effects of the training program were evaluated (n[subscript experimental group]�=�38, n[subscript control group]�=�41). A questionnaire package was administered before and after the implementation of the training program. Outcomes of the ANCOVA revealed that the teachers in the experimental group had significantly more positive attitudes and had increased their knowledge about dyslexia, intellectual disability, ASD, and teaching methods. Moreover, teachers evaluated the training program as relevant and appropriate. The practical implications of the results are discussed in terms of teacher preparation and the implementation of inclusive education."
  },
  {
    "no": 16,
    "key": "9I9APPBY",
    "pop": "Xie 2017, China",
    "link": "http://dx.doi.org/10.1177/0271121416659052",
    "intervention": "Inclusive",
    "outcomes": "Early,Attitude",
    "country": "China",
    "abstract": "China is expected to have a rapid growth in specialized early intervention (EI) services for young children ages birth to 6 and their families. A major barrier in the provision of EI services in China is the shortage of well-trained EI personnel. In 2013, a Home-Based Early Intervention Program (HBEIP) was started at South China Normal University (SCNU) in Guangzhou, China to prepare future professionals to use family-centered EI practices adapted from similar programs in the United States. During the first year of implementation, HBEIP collected data from a self-efficacy survey and a needs assessment. Results from the evaluation showed that Chinese trainees perceived the family-centered approach to EI as relevant and valuable, and indicated needs for improving supervision and coaching supports in future implementation of HBEIP. The research team discussed implications for cross-cultural adaptation and implementation of personnel training practices."
  },
  {
    "no": 17,
    "key": "WU4TRMU9",
    "pop": "Yusuf 2017, Malaysia",
    "link": "http://dx.doi.org/10.4324/9781315397702",
    "intervention": "Inclusive",
    "outcomes": "Primary,Secondary,Pedagogical",
    "country": "Malaysia",
    "abstract": "The concept of inclusive education can be traced from the 1980s when \"integration\" was the main focus for classroom professional practice. During that time, learners were mainly categorized as either 'normal' students or others with special needs. The 21st-century classroom environment has been made accessible and inclusive for the previously excluded special needs students through the introduction of assistive technologies. Assistive technologies are tools designed to assist individuals in meeting their needs by enabling them to participate in learning and related academic tasks by minimizing or overcoming the challenges posed by a body structure disability This chapter shares the experiences of in-service teachers in using group reflections for improving teacher professional knowledge and development of inclusive practices. The participants in this pilot study were enrolled in the master of education program (MEd) on a part-time basis at a public University in Malaysia."
  }
]

// array  that contains the interventions and details. short is used to populate the grid cells
const interventions = [
    {
        "type": "Physical disability",
        "desc": "Includes studies aimed at supporting students with mobility, spinal-cord disability, head injuries, and/ or long term-illness.",
        "short": "physical",
    },
    {
        "type": "Sensory disability",
        "desc": "Includes studies aimed at supporting students with vision, hearing, speech or communication disabilities.",
        "short": "sensory",
    },
    {
        "type": "Mental and intellectual",
        "desc": "Includes studies aimed at supporting students with affect, cognition and learning disabilities.",
        "short": "intellectual",
    },
    {
        "type": "Inclusive",
        "desc": "Includes studies aimed at supporting students with all types of disabilities.",
        "short": "inclusive",
    },
];

// array values are used to populate grid cells by searching data array with these values.
const outcomes = ["early","primary","secondary","special","attitude","pedagogical","managing","learning","behaviour"];

//create array of country names from data country keys
const allCountries = data.map(({country}) => country);
console.log(allCountries);
// unique countries from 
const countries = [...new Set(allCountries)];
console.log(countries);


//https://stackoverflow.com/questions/57550082/creating-a-16x16-grid-using-javascript

//adds the second row of headRows divs to the end of the first row of hard coded headRows and then the intervention rows and then the grid cells.
//adds unique id from data intervention and outcome values and classes to each grid cell
const grid = document.getElementById("grid");

function makeGrid() {
    for (a=0; a<interventions.length; a++) {
        let cell = document.createElement("div");
        cell.innerText = interventions[a].type;
        grid.appendChild(cell).id = interventions[a].short;
        grid.appendChild(cell).className = "intervention headRow";
        

        for (b = 0; b < outcomes.length; b++) {
            let cell = document.createElement("div");
            grid.appendChild(cell).id = interventions[a].short + outcomes[b];
            grid.appendChild(cell).className = interventions[a].short + " " + outcomes[b] + " square";
        };
    };
};
// dimensions of grid including the html hard coded first headRow
makeGrid(6, 10);

//this selects all square elements and then creates an array
let allGrids = document.querySelectorAll(".square");
let allGridsArray = Array.from(allGrids);

//this generates tippys for the interventions as per the interventions array
for (x of interventions) {
    tippy("#" + x.short, {
        maxWidth: 500,
        content: x.desc,
        
        allowHTML: true,
        appendTo: document.body
    });
}

//this uses the array of square elements created above and thier first (intervention) and second (outcome) classes as values to use in the filter search
for (i=0; i < allGridsArray.length; i++) {
    let y = allGridsArray[i].classList[0];
    let z = allGridsArray[i].classList[1];
    //this filters the square element array and creates a new variable to calculate the length to use as the radius of the circle. same filter is used in the tippy generator below
    let pip = data.filter(it => it.intervention.toLowerCase().includes(y) && it.outcomes.toLowerCase().includes(z));
    console.log(pip);
    allGridsArray[i].innerHTML += '<svg class="circle' + z + '" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 100 100"> <circle r=' + pip.length * 8 + ' cx="50%" cy="50%" stroke="FF5F33" stroke-width="2" fill=""/></svg>';

    //this compares the values in the data to the class list on the square element and if they match it adds the link and author text to the tippy.
    let pop = "";
    for(var j = 0; j < data.length; j++){
        if(data[j].intervention.toLowerCase().includes(y) && data[j].outcomes.toLowerCase().includes(z))
            pop += "<a target=_blank" + ' href=' + data[j].link + '>' + data[j].pop +'</a>' + '<br>';

            //this just displays author - use this if there no url in the data file
            // else if(data[j].link === "" && data[j].intervention === y && data[j].outcome.includes(z))
            // pop += data[j].pop + '<br>';
    };
    
    if(pop.length > 0)
    tippy("#" + allGridsArray[i].id, {
    maxWidth: '',
    content: '<p>' + data.filter(it => it.intervention.toLowerCase().includes(y) && it.outcomes.toLowerCase().includes(z)).length + '</p>' + pop,
    allowHTML: true,
    placement: "right",
    boundary: 'parent',
    appendTo: document.body,
    interactive: true
    });
    pop = '';
};
// set variables for grids in each outcome area
let settingGrids = document.querySelectorAll(".setting,.early,.primary,.secondary,.special");
let teacherGrids = document.querySelectorAll(".attitude,.pedagogical,.managing");
let studentGrids = document.querySelectorAll(".learning,.behaviour");
// add classes for show hide outcomes for smaller screens
for (var x = 0; x < settingGrids.length; x++) {
    settingGrids[x].className += ' setting ';
}
for (var x = 0; x < teacherGrids.length; x++) {
    teacherGrids[x].className += ' teacher ';
}
for (var x = 0; x < studentGrids.length; x++) {
    studentGrids[x].className += ' student ';
}
// function to show grids with teacher class and hide others
function showTeacher() {
    document.getElementById("grid").style.gridTemplateColumns = "repeat(4, 20vmin)";
    document.getElementById("teacheroutcomes").style.gridColumn = "2/5";
    Array.from(document.querySelectorAll(".setting,.student"))
    .forEach(function(val) {
        val.style.display = 'none';
    });
    Array.from(document.querySelectorAll(".teacher"))
    .forEach(function(val) {
        val.style.display = 'grid';
    });
}
// function to show grids with student class and hide others
function showStudent() {
    document.getElementById("grid").style.gridTemplateColumns = "repeat(3, 20vmin)";
    document.getElementById("studentoutcomes").style.gridColumn = "2/4";
    Array.from(document.querySelectorAll(".setting,.teacher"))
    .forEach(function(val) {
        val.style.display = 'none';
    });
    Array.from(document.querySelectorAll(".student"))
    .forEach(function(val) {
        val.style.display = 'grid';
    });
}
// function to show grids with setting class and hide others
function showSetting() {
    document.getElementById("grid").style.gridTemplateColumns = "repeat(5, 20vmin)";
    document.getElementById("setting").style.gridColumn = "2/6";
    Array.from(document.querySelectorAll(".setting"))
    .forEach(function(val) {
        val.style.display = 'grid';
    });
    Array.from(document.querySelectorAll(".teacher,.student"))
    .forEach(function(val) {
        val.style.display = 'none';
    });
}

// this is the d3 map https://gist.run/?id=3ccd770923a61f26f55156657e2f51e8 https://bl.ocks.org/d3indepth/raw/3ccd770923a61f26f55156657e2f51e8/
// this is for globe display
// var projection = d3.geoOrthographic()
// .scale(280)
//   .translate([300, 310])
//   .center([0, 5])
//   .rotate([-100,0,0]);

//this is for flat map display
var projection = d3.geoMercator()
.scale(280)
  .translate([80, 310])
  .center([0, 5]);

var geoGenerator = d3.geoPath()
  .projection(projection);


function handleMouseover(d) {

  var pixelArea = geoGenerator.area(d);
  var bounds = geoGenerator.bounds(d);
  var centroid = geoGenerator.centroid(d);
  var measure = geoGenerator.measure(d);

  d3.select('#content .info')
  .text(d.properties.name + ' (path.area = ' + pixelArea.toFixed(1) + ' path.measure = ' + measure.toFixed(1) + ')');

  d3.select('#content .bounding-box rect')
    .attr('x', bounds[0][0])
    .attr('y', bounds[0][1])
    .attr('width', bounds[1][0] - bounds[0][0])
    .attr('height', bounds[1][1] - bounds[0][1]);
  d3.select('#content .centroid')
    .style('display', 'inline')
    .attr('transform', 'translate(' + centroid + ')');
}



//???let y = data.filter(it => it.pop.includes(y) === d.properties.name).length;
// search data.pop for d.properties name 


//colors for paths
// var color = d3.scaleOrdinal()
//     .range(d3.schemeCategory20);

function update(geojson) {
  var u = d3.select('#content g.map')
    .selectAll('path')
    //.data(studies)
    .data(geojson.features);


  u.enter()
    .append('path')
    .attr("id",  d => d.properties.name_long.toLowerCase())
    .attr("class", d => d.properties.name)
    // colors.style("fill", function(d, i) { return color(i); })
    .classed(" land", true)
  //   //.attr("data-tippy-content", d => d.properties.name + "<br>" + "Studies: " + "<br>" + "Title: " + "<br>" + "Abstract: " + "<br>" + "URL: " + studies._enter[0][0].__data__.link + (studies => studies.__data__.link) )
  //   .attr("data-tippy-content", d => d.properties.name + "<br>" + "Studies: " + "<br>" + "Title: " + "<br>" + "Abstract: " + "<br>" + "URL: " + "<a target=_blank" + ' href=' + studies._enter[0][0].__data__.link + '>' + studies._enter[0][0].__data__.pop +'</a>' + '<br>'+
  //   `<div>	
  //   Continent: ${'&nbsp;'.repeat(7)}${d.properties.continent}<br>
  //   Country: ${'&nbsp;'.repeat(5)}${d.properties.name}<br>
  //   No. Studies: ${'&nbsp;'}${d.properties.subregion}<br>
  // </div>`)
    //.attr("data-tippy-content", d => d.properties.continent)
  //   //.attr("text", data => data.abstract)
    .attr('d', geoGenerator)
    .on('mouseover', handleMouseover)
    .on('mouseover', );

console.log(u);

let cpath = document.querySelectorAll(".land");
let cpathArray = Array.from(cpath);
// console.log(cpath);
// console.log(cpathArray);
// console.log(cpathArray[0]);

console.log(countries.length);
let countriesString = countries.toString().toLowerCase();
for (t=0; t<countries.length; t++) {



  for (i=0; i < cpathArray.length; i++) {
      let y = countries[t].toLowerCase();
      console.log(y);
      console.log(countries[t]);

      //this filters the square element array and creates a new variable to calculate the length to use as the radius of the circle. same filter is used in the tippy generator below
      
      let pip = data.filter(it => it.country.toLowerCase().includes(y)) && (cpathArray[i].id.includes(y));
      console.log(pip);
      //allGridsArray[i].innerHTML += '<svg class="circle' + z + '" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 100 100"> <circle r=' + pip.length * 8 + ' cx="50%" cy="50%" stroke="FF5F33" stroke-width="2" fill=""/></svg>';

      //this compares the values in the data to the class list on the square element and if they match it adds the link and author text to the tippy.
      let pop = "";
      for(var j = 0; j < data.length; j++){
          if(data[j].country.toLowerCase().includes(y) && (cpathArray[i].id.includes(y))) {
              pop += "<a target=_blank" + ' href=' + data[j].link + '>' + data[j].pop +'</a>' + '<br>';
              cpathArray[i].classList.add("study");
          }
              //this just displays author - use this if there no url in the data file
              // else if(data[j].link === "" && data[j].intervention === y && data[j].outcome.includes(z))
              // pop += data[j].pop + '<br>';
      };
      
      if(pop.length > 0)
      tippy("#" + cpathArray[i].id, {
      maxWidth: '',
      content: '<p>' + data.filter(it => it.country.toLowerCase().includes(y)).length + '</p>' + pop,
      allowHTML: true,
      placement: "right",
      boundary: 'parent',
      appendTo: document.body,
      interactive: true
      });
      pop = '';
  };
};
}

// This sort of works
// //this uses the array of path elements created above and id value to use in the filter search
// for (i=0; i < cpathArray.length; i++) {
  
//   //this compares the values in the data to path element id and if they match it adds the title abstract and author text to the tippy.
  
//   let hovContent = "";
//   for(var j = 0; j < data.length; j++){
//     let y = cpathArray[i].id;
//     let cntHov = "";
//     if(countries.toString().toLowerCase().includes(y) && data[j].country.toLowerCase().includes(y)) {
//       console.log(y);
    

//      // if(data[j].country.toLowerCase().includes(y))
//       hovContent = data.filter(it => it.country.toLowerCase().includes(y));
      
//       console.log(hovContent);
//         for(k = 0; k<hovContent.length; k++){
//           console.log(y);
          
//           cntHov += '<hr>' + "<a class=cntInfo target=_blank" + ' href=' + data[k].link + '>' + data[k].pop +'</a>' + '<br>' ;
//           //cpathArray[i].innerHTML += '<svg class="circle bob' + '" xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 100 100"> <circle r=' + hovContent.length * 8 + ' cx="50%" cy="50%" stroke="FF5F33" stroke-width="2" fill="black"/></svg>';
//           cpathArray[i].classList.add("study");
        
//           // cntHov = "<div class=modal-body>" + 
//         //    "<div class=text-center>" +
//         //      "<i class=fas fa-check fa-4x mb-3 animated rotateIn></i>" +
//         //      "<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Impedit iusto nulla aperiam blanditiis"+
//         //        "ad consequatur in dolores culpa, dignissimos, eius non possimus fugiat. Esse ratione fuga, enim,"+
//         //        "ab officiis totam.</p>" +
//         //    "</div>" +
//         //  "</div>";

//             //this just displays author - use this if there no url in the data file
//             // else if(data[j].link === "" && data[j].intervention === y && data[j].outcome.includes(z))
//             // pop += data[j].pop + '<br>';
        
  
//     if(hovContent.length > 0)
//         tippy("#" + cpathArray[i].id, {
//         theme: 'white',
//         maxWidth: 300,
//         content: '<p>' + hovContent.length + '</p>' + cntHov,
//         allowHTML: true,
//         followCursor: 'default',
//         // placement: "right",
//         // boundary: 'parent',  
//         appendTo: document.body,
//         interactive: true,
//         trigger: 'click'
//     });
//   };
//   //}
//   cntHov = '';
//   hovContent = '';
//   console.log(hovContent.length);
// }
// };
// }
// }










// tippy('[data-tippy-content]', {
//   followCursor: 'default',
//   allowHTML: true,
//   interactive:true,
//   content,
//   appendTo: document.body
  
// })


//select all path and convert to array of nodes
    
  // let o = d3.select('#content g.map')
  //          .selectAll('path');
  // //let oArray = o.nodes();
// console.log(o.length);
// function update()




//console.log(cpathArray._enter[0][0].__data__.properties.name);

// const studies = d3.selectAll('path')
//   .selectAll('path')
//   .data(data);

//   console.log(studies);


// let studiesArray = Array.from.studies;
// console.log(studies);
// console.log(studiesArray);
// let match = [];
// //match = studiesArray.filter(country => country.hasOwnProperty('india'));

// console.log(match);
  
//   console.log(studies._enter[0][0].__data__.link);
// // let studies = []; 
// for(c=0; countries.length; c++) {
//   studies += data.filter(it => it.country.includes(countries[c]))
// }


// Promise.all([
//   d3.json("countries.json"),
//   d3.csv("studies.csv"),
// ]).then(function(alldata) {
//   console.log(alldata[0])  // first row of cities
//   console.log(alldata[1])  // first row of animals
// });

// REQUEST DATA
d3.json('countries.json', function(err, json) {
  update(json)
})

// hovers for outcomes descriptions
tippy("#teacherattitudes", {
  maxWidth: 500,
  content: "Relates to teachers’ attitudes (acceptance, confidence, and self- efficacy) towards children with disabilities and knowledge about and understanding of inclusive practices.",
  allowHTML: true,
  appendTo: document.body
});
tippy("#teacherpedagogical", {
  maxWidth: 500,
  content: "Focuses on teachers’ gaining skills to improve pedagogical practice for the purpose of improving inclusive practices and educational outcomes for children with disabilities.",
  allowHTML: true,
  appendTo: document.body
});
tippy("#teachermanaging", {
  maxWidth: 500,
  content: "Enables teachers to develop strategies to more effectively manage behaviour issues among children with disabilities.",
  allowHTML: true,
  appendTo: document.body
});
tippy("#studentlearning", {
  maxWidth: 500,
  content: "Results in positive learning and achievement outcomes for children with disabilities.",
  allowHTML: true,
  appendTo: document.body
});
tippy("#studentbehaviour", {
  maxWidth: 500,
  content: "Improves the behaviour and engagement of children with disabilities.",
  allowHTML: true,
  appendTo: document.body
});

// let allLand = document.querySelectorAll(".land");
// let allLandArray = Array.from(allLand);
// console.log(allLandArray);
// console.log(allLand);


// Loading Multiple Files
// D3's basic loading mechanism is fine for one file, but starts to get messy as we nest multiple callbacks.

// For loading multiple files, we can use Promises to wait for multiple data sources to be loaded.

// Promise.all([
//   d3.csv("/data/cities.csv"),
//   d3.tsv("/data/animals.tsv")
// ]).then(function(data) {
//   console.log(data[0][0])  // first row of cities
//   console.log(data[1][0])  // first row of animals
// });

// => {city: "seattle", state: "WA", population: "652405", land area: "83.9"}
// {name: "tiger", type: "mammal", avg_weight: "260"}
// This code is using d3.js
// Note that inside the all method we load two types of files - using two different loading functions - so this is an easy way to mix and match file types.

// The method returns an array of our data sources. The first item returns our cities; the second, our animals.